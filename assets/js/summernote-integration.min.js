function deleteFile(e){$.ajax({data:{src:e},method:"POST",url:base_url+"summernote/deleteFile",cache:!1,success:e=>{toastr.success(e)},error:e=>{toastr.error(resp)},complete:()=>{oldValue=$(".note-editable.card-block")[0].innerHTML}})}function deleteOnCascade(e){""!=e&&$.ajax({data:{imgs:JSON.stringify(e)},method:"POST",url:base_url+"summernote/deleteOnCascade",cache:!1,success:e=>{console.log(e)}})}function ajax_imgs(e){$.ajax({data:"",type:"GET",url:base_url+"summernote/getImgs/"+e,async:!0,success:a=>{a.content=a.content.match(/<img\s(?:.+?)>/g);var s=[];$.each(a.content,function(e,a){var t=a.match(/src="([^"]*)"/);t=t[1].split("/assets/uploads/"),s.push(t[1])}),0!=s.length&&deleteOnCascade(s),window.location.href=base+"news/delete_news/"+e},dataType:"json"})}const base_url=$("#base_url").val();oldValue="",$("#summernote").summernote({height:300,callbacks:{onInit:()=>{oldValue=this.value},onImageUpload:e=>{for(var a=0;a<e.length;a++)$.upload(e[a],$(this))},onMediaDelete:e=>{deleteFile(e[0].src)},onKeyup:e=>{if(8==e.keyCode||46==e.keyCode){var a=e.target.innerHTML,s=oldValue.match(/<img\s(?:.+?)>/g);s=s||[];var t=a.match(/<img\s(?:.+?)>/g);t=t||[],oldValue=a;var o=[];$.each(s,(e,a)=>{var s=0;if($.each(t,(e,t)=>{a==t&&(s=1)}),0==s){var l=a.match(/src="([^"]*)"/);l=l[1].split("/assets/uploads/"),o.push(l[1])}}),0!=o.length?deleteOnCascade(o):oldValue=$(".note-editable.card-block")[0].innerHTML}}}}),$.upload=((e,a)=>{let s=new FormData;s.append("file",e,e.name),$.ajax({data:s,method:"POST",url:base_url+"summernote/uploadFile",cache:!1,processData:!1,contentType:!1,success:e=>{if(0==e.error){a.summernote("insertImage",e.message,function(e){e.addClass("img-fluid"),e.attr("style",!1)});var s=e.message.split("/assets/uploads/");i++,vetor[i]=s[1],a[0].oldValue=$(".note-editable.card-block")[0].innerHTML,oldValue=a[0].oldValue+'<img src="'+base_url+"assets/uploads/"+s[1]+'">'}else toastr.warning(e.message)},error:e=>{alert("Algo deu errado.")},dataType:"json"})}),$(document).on("submit","form",e=>{$(window).off("beforeunload")}),$(window).bind("beforeunload",e=>{deleteOnCascade(vetor)});