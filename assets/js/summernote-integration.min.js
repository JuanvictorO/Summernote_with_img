function deleteFile(e){$.ajax({data:{src:e},method:"POST",url:base+"summernote/deleteFile",cache:!1,success:function(e){toastr.success(e)},error:function(e){toastr.error(e)},complete:function(){oldValue=$(".note-editable.card-block")[0].innerHTML}})}function deleteOnCascade(e){""!=e&&$.ajax({data:{imgs:JSON.stringify(e)},method:"POST",url:base+"summernote/deleteOnCascade",cache:!1,success:function(e){console.log(e)}})}function ajax_imgs(e){$.ajax({data:"",type:"GET",url:base+"summernote/getImgs/"+e,async:!0,success:function(a){a.content=a.content.match(/<img\s(?:.+?)>/g);var t=[];$.each(a.content,function(e,a){var o=a.match(/src="([^"]*)"/);o=o[1].split("/assets/uploads/"),t.push(o[1])}),0!=t.length&&deleteOnCascade(t),window.location.href=base+"summernote/deleteBlog/"+e},dataType:"json"})}const base=$("#base_url").val();oldValue="",$(".summernote").summernote({height:300,callbacks:{onInit:function(){oldValue=this.value},onImageUpload:function(e){for(var a=0;a<e.length;a++)$.upload(e[a],$(this))},onMediaDelete:function(e){deleteFile(e[0].src)},onKeyup:function(e){if(8==e.keyCode||46==e.keyCode){var a=e.target.innerHTML,t=oldValue.match(/<img\s(?:.+?)>/g);t=t||[];var o=a.match(/<img\s(?:.+?)>/g);o=o||[],oldValue=a;var n=[];$.each(t,function(e,a){var t=0,s=a.match(/src="([^"]*)"/);if($.each(o,function(e,a){var o=a.match(/src="([^"]*)"/);if(console.log(s[1]+" == "+o[1]),s[1]==o[1])return t=1,console.log(t),!1}),0==t){var c=a.match(/src="([^"]*)"/);c=c[1].split("/assets/uploads/"),n.push(c[1])}}),0!=n.length?deleteOnCascade(n):oldValue=$(".note-editable.card-block")[0].innerHTML}}}}),vetor=[""],i=-1,$.upload=function(e,a){let t=new FormData;t.append("file",e,e.name),$.ajax({data:t,method:"POST",url:base+"summernote/uploadFile",cache:!1,processData:!1,contentType:!1,success:function(e){if(0==e.error){a.summernote("insertImage",e.message,function(e){e.addClass("img-fluid"),e.attr("style",!1)});var t=e.message.split("/assets/uploads/");i++,vetor[i]=t[1],a[0].oldValue=$(".note-editable.card-block")[0].innerHTML,oldValue=a[0].oldValue+'<img src="'+base+"assets/uploads/"+t[1]+'">'}else toastr.warning(e.message)},error:function(e){alert("Algo deu errado.")},dataType:"json"})},$(document).on("submit","form",function(e){$(window).off("beforeunload")}),$(window).bind("beforeunload",function(e){deleteOnCascade(vetor)});